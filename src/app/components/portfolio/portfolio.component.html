<ng-template #menu let-position="position">
    <app-navigation [position]="position"></app-navigation>
</ng-template>
<ng-template #search let-position="position">
    <app-search [position]="position"></app-search>
</ng-template>

<!-- TODO: reuse this template. -->
<ng-template #headerLink let-key="key">
    <a [ngClass]="[(entities[key]?.class ? entities[key]?.class : ''), 'header-link']" (click)="$event.stopPropagation()" title="{{ linkToThisText }}"
        href="/{{ componentName }}#{{ key }}" role="tab">
        <i class="material-icons d-print-none">{{ linkToThisSymbol }}</i>
    </a>
</ng-template>

<nav role="navigation" class="navbar navbar-expand-md navbar-light shadow-sm p-2 mb-2 background-color rounded d-print-none">
    <title>CV Generator</title>

    <a class="navbar-brand d-flex d-md-block align-items-baseline" href="/">
        <img src="{{ getAssetUri('CV Generator logo.png') }}" onerror="this.style.display='none'" alt="" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div *ngIf="uiDefined() && (cvDefined() || projectsDefined() || generalTimelineDefined())" class="flex-grow-1">
            <ng-container *ngTemplateOutlet="menu;context:{position: ''}"></ng-container>
            <ng-container *ngTemplateOutlet="search;context:{position: ''}"></ng-container>
        </div>
    </div>
</nav>

<main role="main" class="container-fluid">
    <div *ngIf="entitiesDefined() && uiDefined()">
        <div *ngIf="cvDefined()">
            <ng-container *ngIf="count(cv['Personal data'], 'Personal data', '~') + count(cv['Education'],
            'Period') + count(cv['Professional experience'], 'Period') + count(cv['Certifications'], 'Name',
            '~') + count(cv['Languages'], 'Language') + countCache['Name'] + countCache['Title'] > 0">
                <div class="tryKeepTogether">
                    <header id="{{ entities['Curriculum Vitae']?.key }}" (click)="saveToggle($event)" data-toggle="collapse" [attr.data-target]="'#' + entities['Curriculum Vitae']?.content"
                        role="tabpanel" [attr.aria-labelledby]="tabName('Curriculum Vitae')">
                        <h1>
                            <ng-container *ngTemplateOutlet="headerLink;context:{key: 'Curriculum Vitae'}"></ng-container>
                            {{ entities['Curriculum Vitae']?.section }} ({{ count(cv['Personal data'], 'Personal data', '~') + count(cv['Education'],
                            'Period') + count(cv['Professional experience'], 'Period') + count(cv['Certifications'], 'Name',
                            '~') + count(cv['Languages'], 'Language') + countCache['Name'] + countCache['Title'] }})
                        </h1>
                    </header>
                    <div id="{{ entities['Curriculum Vitae']?.content }}" class="collapse show">
                        <div class="columns2">
                            <app-cv></app-cv>
                        </div>
                        <hr>
                    </div>
                </div>
            </ng-container>
        </div>

        <div *ngIf="projectsDefined()">
            <ng-container *ngIf="countCache[entities['Project Summary']?.node] > 0">
                <div class="tryKeepTogether page-break">
                    <header id="{{ entities['Project Summary']?.key }}" (click)="saveToggle($event)" data-toggle="collapse" [attr.data-target]="'#' + entities['Project Summary']?.content"
                        [attr.aria-labelledby]="tabName('Project Summary')">
                        <h1 class="columns1">
                            <ng-container *ngTemplateOutlet="headerLink;context:{key: 'Project Summary'}"></ng-container>
                            {{ entities['Project Summary']?.section }} ({{ countCache[entities['Project Summary']?.node] }})
                            <span align="right" class="btn-group btn d-print-none extra-function" role="radiogroup" aria-labelledby="viewMode" (click)="$event.stopPropagation()">
                                <label id="viewMode">{{ ui['Mode']?.text }}:</label>
                                <label id="tag cloud label" for="tag cloud radio" class="btn" (click)="this.tagCloud=this.tagCloudDisplayMode.tagCloud">
                                    <input type="radio" id="tag cloud radio" [(ngModel)]="tagCloud" [value]="tagCloudDisplayMode.tagCloud" name="options" role="radio"
                                        aria-labelledby="tag cloud label">{{ ui['tag cloud']?.text }}
                                </label>
                                <label id="chart label" for="chart radio" class="btn" (click)="this.tagCloud=this.tagCloudDisplayMode.chart">
                                    <input type="radio" id="chart radio" [(ngModel)]="tagCloud" [value]="tagCloudDisplayMode.chart" name="options" role="radio"
                                        aria-labelledby="chart label">{{ ui['chart']?.text }}
                                </label>
                                <label id="both label" for="both radio" class="btn" (click)="this.tagCloud=this.tagCloudDisplayMode.both">
                                    <input type="radio" id="both radio" [(ngModel)]="tagCloud" [value]="tagCloudDisplayMode.both" name="options" role="radio"
                                        aria-labelledby="both label">{{ ui['both']?.text }}
                                </label>
                            </span>
                        </h1>
                    </header>
                    <div id="{{ entities['Project Summary']?.content }}" class="collapse show">
                        <div class="columns2">
                            <app-project-summary></app-project-summary>
                        </div>
                        <hr>
                    </div>
                </div>
            </ng-container>

            <ng-container *ngIf="filteredProjects.length > 0">
                <div class="tryKeepTogether page-break">
                    <header id="{{ entities['Project Portfolio']?.key }}" (click)="saveToggle($event)" data-toggle="collapse" [attr.data-target]="'#' + entities['Project Portfolio']?.content"
                        [attr.aria-labelledby]="tabName('Project Portfolio')">
                        <h1>
                            <ng-container *ngTemplateOutlet="headerLink;context:{key: 'Project Portfolio'}"></ng-container>
                            {{ entities['Project Portfolio']?.section }} ({{ filteredProjects.length }})</h1>
                    </header>
                    <div id="{{ entities['Project Portfolio']?.content }}" class="collapse show">
                        <div class="columns1">
                            <app-project></app-project>
                            <hr>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>

        <app-general-timeline></app-general-timeline>

        <div class="page-break">
        </div>
    </div>
</main>

<aside role="complementary" class="container-fluid">
    <div *ngIf="(cvDefined() || projectsDefined()) && uiDefined()" class="d-print-none">
        <div id="footer" class="container text-right">
            <a title="{{ ui['Go to top']?.text }}" href='/{{ componentName }}#'>
                <img src="{{ getAssetUri('back_to_top.png') }}" onerror="this.style.display='none'" class="btn-square" alt="{{ ui['Up']?.text }}"
                />
            </a>
        </div>
        <br />

        <ng-container *ngTemplateOutlet="search;context:{position: ' bottom'}"></ng-container>
        <ng-container *ngTemplateOutlet="menu;context:{position: ' bottom'}"></ng-container>

    </div>
</aside>

<footer role="contentinfo" class="container-fluid">
    <div *ngIf="(cvDefined() || projectsDefined()) && uiDefined()" class="d-print-none">
        <app-footer></app-footer>
    </div>
</footer>